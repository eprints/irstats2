<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="IRStats2 : Statistical tools for EPrints" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>IRStats2</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/eprints/irstats2">View on GitHub</a>

          <h1 id="project_title">IRStats2</h1>
          <h2 id="project_tagline">Statistical tools for EPrints</h2>
            <section id="topmenu">
              <a href="./install.html">Installation</a>
              <a href="./config.html">Configuration</a>
              <a href="./api.html">API</a>
            </section>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2><a name="irstats2-installation" class="anchor" href="#irstats2-installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<h3>Dependencies</h3>

<ul>
<li>Geo::IP or Geo::IP::PurePerl</li>
<li>Date::Calc</li>
</ul>

<p>Both can usually be installed via your Linux package managers (apt-get, yum, ...) or via CPAN if you must.</p>

<h3>EPrints 3.3</h3>

<p>IRStats2 can be installed directly via the Bazaar on EPrints 3.3 which makes the installation much simpler than with EPrints 3.2.</p>

<h4>EPrints 3.3.11 onwards</h4>

<p>Installing IRStats2 from the Bazaar is all you need to do. I recommend that you restart Apache after doing so.</p>

<h4>EPrints 3.3.1 to 3.3.10</h4>

<p>You need to install IRStats2 from the Bazaar as above but you need to apply a few patches. Note that you only really need these patches to have the Google "map of the world" working. Everything else should work as normal without the patches.</p>

<p>The patches relate to an incompatibility between the Prototype JS library (used by EPrints) and Google Charts (used by IRStats2). The two patches you need to apply are:
<ul>
<li><a href="https://github.com/eprints/eprints/commit/f7a9088aae29b8732cb5d8edd83d17e94f069e63">Upgrade Prototype</a></li>
<li><a href="https://github.com/eprints/eprints/issues/130">Fix auto-completers</a></li>
</ul>
</p>

<h3>EPrints 3.2.x</h3>

<p>On EPrints 3.2 you will have to manually copy the required files to your EPrints installation path. It is a low-risk operation since IRStats2 is a true add-on to EPrints and it does not interact with the core software. You may want to back-up your EPrints files and your database but again, this should not be necessary.</p>

<ol>
<li>Get the files from GitHub or by following this <a href="https://github.com/eprints/irstats2/tarball/master">direct link</a> [tar.gz]</li>
<li>Copy the modules and various configuration files to your local archive:
<pre>
cp bin/* /opt/eprints3/archives/<ID>/bin/
cp cfg/* /opt/eprints3/archives/<ID>/cfg/
cp cgi/* /opt/eprints3/archives/<ID>/cgi/

(create the bin and cgi directories if they don't exist).
</pre>
</li>

<li>Test everything is OK: 
<pre>
/opt/eprints3/bin/epadmin test
</pre>
</li>

<li>Add in the &lt;head&gt; sections of your template files (usually located in /opt/eprints3/archives/<id>/cfg/lang/en/templates/) the following:

<pre>
<!-- IRStats2 -->
&lt;script type="text/javascript" src="http://www.google.com/jsapi"&gt;// &lt;!-- No script --&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
        google.load("visualization", "1", {packages:["corechart", "geochart"]});
&lt;/script&gt;
</pre>

</li>

<li>Restart the web server</li>
</ol>

<h3>Processing</h3>

<p>Processing works in two steps: the initial processing and then a daily incremental processing. Because the initial processing will take care of all your legacy "download" data, this can take a long time. I do mean: a loooooong time. It can take a few days if your repository is very large. More likely it will take a few hours.</p>

<p>For the initial processing, run, as the "eprints" user, the above command. And remember this may take a long time to complete. So if you are running it from an SSH session, you may want to use the "screen" Linux utility to make sure your SSH session will persist.</p>

<pre>
/opt/eprints3/archives/REPO_ID/bin/stats/process_stats REPO_ID --setup --verbose
</pre>

<p>For the daily incremental processing, add the following line in cron. I let you the liberty of deciding when that cron job should run but it is a good idea to do over-night when there is less traffic to your repository.</p>

<pre>
perl /opt/eprints3/archives/REPO_ID/bin/stats/process_stats REPO_ID 1&gt;/dev/null 2&gt;/dev/null
</pre>

<p>The two redirections to /dev/null forces the process to not output anything.</p>

<p>When the initial processing has completed, you may point your browser to http://yourrepo.url/cgi/stats/report to look at some stats!</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">IRStats2 maintained by <a href="https://github.com/eprints">EPrints</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

  </body>
</html>
